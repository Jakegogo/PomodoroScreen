# Idle vs Pause çŠ¶æ€åˆ†æž

## ðŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æ·±å…¥åˆ†æž PomodoroScreen åº”ç”¨ä¸­ `idle` å’Œ `pause` çŠ¶æ€çš„åŒºåˆ«ã€è®¾è®¡åˆç†æ€§ï¼Œå¹¶æå‡ºæ”¹è¿›å»ºè®®ã€‚

## ðŸ” å½“å‰çŠ¶æ€è®¾è®¡åˆ†æž

### 1. Idle çŠ¶æ€ï¼ˆç©ºé—²çŠ¶æ€ï¼‰

#### å®šä¹‰å’Œè§¦å‘æ¡ä»¶
- **çŠ¶æ€æœºçŠ¶æ€**: `.idle`
- **è§¦å‘æ–¹å¼**: 
  - ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»"åœæ­¢"æŒ‰é’® â†’ `stop()` æ–¹æ³•
  - è®¡æ—¶å™¨å®ŒæˆåŽè‡ªåŠ¨è§¦å‘ â†’ `timerFinished()` â†’ `stop()`
  - ç”¨æˆ·ç‚¹å‡»"é‡ç½®"æŒ‰é’® â†’ `reset()` æ–¹æ³•ï¼ˆå†…éƒ¨è°ƒç”¨ `stop()`ï¼‰

#### çŠ¶æ€ç‰¹å¾
```swift
func stop() {
    timer?.invalidate()           // åœæ­¢è®¡æ—¶å™¨
    timer = nil                   // æ¸…ç©ºè®¡æ—¶å™¨å¼•ç”¨
    isPaused = false              // è®¾ç½®ä¸ºéžæš‚åœçŠ¶æ€
    processAutoRestartEvent(.timerStopped)  // çŠ¶æ€æœºè½¬ä¸º .idle
}
```

#### å…³é”®è¡Œä¸º
- **å‰©ä½™æ—¶é—´**: ä¿æŒä¸å˜ï¼ˆé™¤éžè°ƒç”¨ `reset()`ï¼‰
- **çŠ¶æ€æœº**: è½¬æ¢åˆ° `.idle` çŠ¶æ€
- **æ¢å¤æ–¹å¼**: è°ƒç”¨ `start()` æ–¹æ³•
- **è®¾ç½®å½±å“**: å¯ä»¥è¢«è®¾ç½®æ›´æ–°é‡ç½®å‰©ä½™æ—¶é—´

### 2. Pause çŠ¶æ€ï¼ˆæš‚åœçŠ¶æ€ï¼‰

#### å®šä¹‰å’Œè§¦å‘æ¡ä»¶
- **çŠ¶æ€æœºçŠ¶æ€**: `.timerPausedByIdle`, `.timerPausedBySystem`
- **è§¦å‘æ–¹å¼**:
  - æ‰‹åŠ¨è°ƒç”¨ `pause()` æ–¹æ³•ï¼ˆç›®å‰UIä¸­æœªä½¿ç”¨ï¼‰
  - ç³»ç»Ÿè‡ªåŠ¨æš‚åœï¼šæ— æ“ä½œè¶…æ—¶ã€é”å±ã€å±ä¿å¯åŠ¨

#### çŠ¶æ€ç‰¹å¾
```swift
func pause() {
    timer?.invalidate()           // åœæ­¢è®¡æ—¶å™¨
    timer = nil                   // æ¸…ç©ºè®¡æ—¶å™¨å¼•ç”¨
    isPaused = true               // è®¾ç½®ä¸ºæš‚åœçŠ¶æ€
    processAutoRestartEvent(.timerPaused)  // çŠ¶æ€æœºè½¬ä¸ºæš‚åœçŠ¶æ€
}
```

#### å…³é”®è¡Œä¸º
- **å‰©ä½™æ—¶é—´**: ä¿æŒä¸å˜
- **çŠ¶æ€æœº**: è½¬æ¢åˆ°æš‚åœç›¸å…³çŠ¶æ€
- **æ¢å¤æ–¹å¼**: è°ƒç”¨ `resume()` æ–¹æ³•æˆ–ç³»ç»Ÿè‡ªåŠ¨æ¢å¤
- **è®¾ç½®å½±å“**: ä¸ä¼šè¢«è®¾ç½®æ›´æ–°é‡ç½®

## ðŸ“Š è¯¦ç»†å¯¹æ¯”è¡¨

| ç‰¹æ€§ | Idle çŠ¶æ€ | Pause çŠ¶æ€ |
|------|-----------|------------|
| **è§¦å‘æ–¹å¼** | ç”¨æˆ·ä¸»åŠ¨åœæ­¢/é‡ç½® | ç³»ç»Ÿè‡ªåŠ¨æš‚åœ/æ‰‹åŠ¨æš‚åœ |
| **`isPaused` å€¼** | `false` | `true` |
| **çŠ¶æ€æœºçŠ¶æ€** | `.idle` | `.timerPausedByIdle/.timerPausedBySystem` |
| **å‰©ä½™æ—¶é—´ä¿æŒ** | âœ… æ˜¯ï¼ˆé™¤éžresetï¼‰ | âœ… æ˜¯ |
| **è®¾ç½®å¯é‡ç½®æ—¶é—´** | âœ… æ˜¯ | âŒ å¦ |
| **è‡ªåŠ¨å¯åŠ¨å½±å“** | âœ… å¯è§¦å‘ | âŒ ä¸è§¦å‘ |
| **æ¢å¤æ–¹æ³•** | `start()` | `resume()` |
| **ç”¨æˆ·æ„å›¾** | ä¸»åŠ¨ä¸­æ–­ | ä¸´æ—¶æš‚åœ |

## ðŸ¤” è®¾è®¡åˆç†æ€§åˆ†æž

### âœ… åˆç†ä¹‹å¤„

#### 1. è¯­ä¹‰æ¸…æ™°
- **Idle**: è¡¨ç¤º"ç©ºé—²"ï¼Œç”¨æˆ·ä¸»åŠ¨åœæ­¢ï¼Œå¯ä»¥é‡æ–°å¼€å§‹
- **Pause**: è¡¨ç¤º"æš‚åœ"ï¼Œä¸´æ—¶ä¸­æ–­ï¼ŒæœŸæœ›æ¢å¤

#### 2. è¡Œä¸ºåŒºåˆ†æ˜Žç¡®
- **è®¾ç½®æ›´æ–°**: Idle çŠ¶æ€å…è®¸é‡ç½®ï¼ŒPause çŠ¶æ€ä¿æŠ¤è¿›åº¦
- **è‡ªåŠ¨å¯åŠ¨**: Idle çŠ¶æ€å¯è§¦å‘ï¼ŒPause çŠ¶æ€ä¸å¹²æ‰°

#### 3. ç”¨æˆ·ä½“éªŒè‰¯å¥½
- åœæ­¢åŽå¯ä»¥"ç»§ç»­"ï¼Œç¬¦åˆç”¨æˆ·é¢„æœŸ
- ç³»ç»Ÿæš‚åœåŽè‡ªåŠ¨æ¢å¤ï¼Œæ— éœ€ç”¨æˆ·å¹²é¢„

### âš ï¸ æ½œåœ¨é—®é¢˜

#### 1. æ¦‚å¿µæ··æ·†
```swift
// é—®é¢˜ï¼šç”¨æˆ·"åœæ­¢"åŽï¼Œå†…éƒ¨çŠ¶æ€æ˜¯"idle"ï¼Œä½†UIæ˜¾ç¤º"ç»§ç»­"
// è¿™åœ¨è¯­ä¹‰ä¸Šå­˜åœ¨ä¸ä¸€è‡´
if currentState == .idle && remainingTime > 0 && remainingTime < getTotalTime() {
    return true  // canResume = trueï¼Œæ˜¾ç¤º"ç»§ç»­"
}
```

#### 2. çŠ¶æ€åˆ¤æ–­å¤æ‚
```swift
// éœ€è¦å¤æ‚çš„é€»è¾‘æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥ç»§ç»­
var canResume: Bool {
    if isPausedState { return true }
    
    // é¢å¤–çš„idleçŠ¶æ€åˆ¤æ–­
    let currentState = autoRestartStateMachine.getCurrentState()
    if currentState == .idle && remainingTime > 0 && remainingTime < getTotalTime() {
        return true
    }
    return false
}
```

#### 3. è®¾ç½®è¡Œä¸ºä¸ä¸€è‡´
- **Idle + æœ‰å‰©ä½™æ—¶é—´**: ç”¨æˆ·æœŸæœ›"ç»§ç»­"ï¼Œä½†è®¾ç½®ä¼šé‡ç½®è¿›åº¦
- **Pause**: è®¾ç½®ä¸ä¼šé‡ç½®è¿›åº¦
- è¿™ç§ä¸ä¸€è‡´å¯èƒ½å¯¼è‡´ç”¨æˆ·å›°æƒ‘

## ðŸ”§ æ”¹è¿›å»ºè®®

### æ–¹æ¡ˆ1ï¼šå¼•å…¥æ–°çš„"Stopped"çŠ¶æ€

```swift
enum TimerState {
    case idle       // å…¨æ–°çŠ¶æ€ï¼Œæœªå¼€å§‹
    case running    // è¿è¡Œä¸­
    case paused     // æš‚åœï¼ˆç³»ç»Ÿæˆ–æ‰‹åŠ¨ï¼‰
    case stopped    // åœæ­¢ä½†å¯ç»§ç»­
}
```

**ä¼˜ç‚¹**ï¼š
- è¯­ä¹‰æ›´æ¸…æ™°
- çŠ¶æ€åˆ¤æ–­ç®€å•
- è¡Œä¸ºä¸€è‡´æ€§å¥½

**ç¼ºç‚¹**ï¼š
- éœ€è¦é‡æž„çŽ°æœ‰çŠ¶æ€æœº
- å½±å“èŒƒå›´è¾ƒå¤§

### æ–¹æ¡ˆ2ï¼šä¼˜åŒ–å½“å‰è®¾è®¡

#### 2.1 ç»Ÿä¸€è®¾ç½®è¡Œä¸º
```swift
// ä¿®æ”¹è®¾ç½®æ›´æ–°é€»è¾‘ï¼Œå¯¹"å¯ç»§ç»­"çŠ¶æ€ä¸€è‡´å¤„ç†
if !isRunning && !canResume {  // åªæœ‰çœŸæ­£ç©ºé—²æ—¶æ‰é‡ç½®
    remainingTime = newPomodoroTime
}
```

#### 2.2 æ”¹è¿›çŠ¶æ€åˆ¤æ–­
```swift
// ç®€åŒ–canResumeé€»è¾‘
var canResume: Bool {
    return isPausedState || (remainingTime > 0 && remainingTime < getTotalTime())
}
```

### æ–¹æ¡ˆ3ï¼šé‡æ–°å®šä¹‰Stopè¯­ä¹‰

å°† `stop()` æ–¹æ³•æ”¹ä¸ºçœŸæ­£çš„"åœæ­¢"ï¼š

```swift
func stop() {
    timer?.invalidate()
    timer = nil
    isPaused = false
    remainingTime = pomodoroTime  // é‡ç½®æ—¶é—´
    processAutoRestartEvent(.timerStopped)
}

func pause() {
    // ç”¨äºŽç”¨æˆ·ä¸»åŠ¨æš‚åœ
    guard isRunning else { return }
    timer?.invalidate()
    timer = nil
    isPaused = true
    processAutoRestartEvent(.timerPaused)
}
```

## ðŸ“ˆ æŽ¨èæ–¹æ¡ˆ

### å»ºè®®é‡‡ç”¨æ–¹æ¡ˆ2ï¼šä¼˜åŒ–å½“å‰è®¾è®¡

**ç†ç”±**ï¼š
1. **æœ€å°åŒ–å½±å“**: ä¸éœ€è¦å¤§è§„æ¨¡é‡æž„
2. **ä¿æŒå…¼å®¹**: çŽ°æœ‰åŠŸèƒ½å’Œæµ‹è¯•ä¸å—å½±å“
3. **è§£å†³æ ¸å¿ƒé—®é¢˜**: ç»Ÿä¸€è®¾ç½®è¡Œä¸ºï¼Œç®€åŒ–çŠ¶æ€åˆ¤æ–­

### å…·ä½“å®žçŽ°æ­¥éª¤

#### 1. ä¿®æ”¹è®¾ç½®æ›´æ–°é€»è¾‘
```swift
// åœ¨ updateRemainingTimeIfNeeded ä¸­
if !isRunning && !canResume {  // åªæœ‰å®Œå…¨ç©ºé—²æ—¶æ‰é‡ç½®
    remainingTime = newPomodoroTime
    updateTimeDisplay()
    print("âš™ï¸ Timer idle, updated to new pomodoro time")
    return
}
```

#### 2. ä¼˜åŒ–canResumeåˆ¤æ–­
```swift
var canResume: Bool {
    // ç®€åŒ–é€»è¾‘ï¼ŒåŸºäºŽå‰©ä½™æ—¶é—´åˆ¤æ–­
    return isPausedState || (remainingTime > 0 && remainingTime < getTotalTime())
}
```

#### 3. æ·»åŠ çŠ¶æ€è¯´æ˜Žæ³¨é‡Š
```swift
// çŠ¶æ€è¯´æ˜Žï¼š
// - idle + remainingTime == totalTime: å…¨æ–°çŠ¶æ€ï¼Œæ˜¾ç¤º"å¼€å§‹"
// - idle + 0 < remainingTime < totalTime: åœæ­¢ä½†å¯ç»§ç»­ï¼Œæ˜¾ç¤º"ç»§ç»­"  
// - paused: æš‚åœçŠ¶æ€ï¼Œæ˜¾ç¤º"ç»§ç»­"
// - running: è¿è¡ŒçŠ¶æ€ï¼Œæ˜¾ç¤º"åœæ­¢"
```

## ðŸ§ª æµ‹è¯•éªŒè¯

### éœ€è¦éªŒè¯çš„åœºæ™¯

1. **åœæ­¢åŽè®¾ç½®æ›´æ”¹**: åº”è¯¥ä¿æŒå‰©ä½™æ—¶é—´ä¸å˜
2. **åœæ­¢åŽè‡ªåŠ¨å¯åŠ¨**: åº”è¯¥ä»Žåœæ­¢ä½ç½®ç»§ç»­
3. **å…¨æ–°å¯åŠ¨è®¾ç½®æ›´æ”¹**: åº”è¯¥æ›´æ–°ä¸ºæ–°çš„ç•ªèŒ„é’Ÿæ—¶é—´
4. **æš‚åœçŠ¶æ€è¡Œä¸º**: ä¿æŒçŽ°æœ‰è¡Œä¸ºä¸å˜

## ðŸ“ æ€»ç»“

å½“å‰çš„ idle å’Œ pause è®¾è®¡åœ¨æ¦‚å¿µä¸Šæ˜¯åˆç†çš„ï¼Œä½†åœ¨å®žçŽ°ç»†èŠ‚ä¸Šå­˜åœ¨ä¸€äº›ä¸ä¸€è‡´æ€§ã€‚é€šè¿‡ä¼˜åŒ–è®¾ç½®æ›´æ–°é€»è¾‘å’Œç®€åŒ–çŠ¶æ€åˆ¤æ–­ï¼Œå¯ä»¥åœ¨ä¿æŒçŽ°æœ‰æž¶æž„çš„åŸºç¡€ä¸Šï¼Œæå‡ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ã€‚

**æ ¸å¿ƒåŽŸåˆ™**ï¼š
- **Idle**: ç”¨æˆ·ä¸»åŠ¨æŽ§åˆ¶çš„çŠ¶æ€ï¼Œæ”¯æŒè®¾ç½®é‡ç½®ï¼ˆä»…å…¨æ–°çŠ¶æ€ï¼‰
- **Pause**: ç³»ç»Ÿæˆ–ä¸´æ—¶æš‚åœï¼Œä¿æŠ¤ç”¨æˆ·è¿›åº¦
- **Stopped**: Idleçš„å­çŠ¶æ€ï¼Œæœ‰è¿›åº¦ä½†è¢«ç”¨æˆ·åœæ­¢ï¼Œè¡Œä¸ºç±»ä¼¼Pause

è¿™ç§è®¾è®¡æ—¢ä¿æŒäº†è¯­ä¹‰çš„æ¸…æ™°æ€§ï¼Œåˆç¡®ä¿äº†ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ã€‚

---

*åˆ†æžæ—¥æœŸï¼š2025å¹´9æœˆ22æ—¥*  
*ç‰ˆæœ¬ï¼šv1.0.0*
