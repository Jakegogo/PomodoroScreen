# 健康环统计维度与计算公式

## 📊 概述

健康环（HealthRings）是PomodoroScreen应用中的核心数据可视化组件，通过四个同心圆环展示用户的工作健康状况。每个圆环代表不同的健康维度，采用0-100分的评分体系。

## 🎯 四个维度

### 1. 🔴 休息充足度 (Rest Adequacy) - 外环
**颜色**: 红色渐变  
**位置**: 最外层圆环 (直径: 82%)  
**目标**: 评估用户是否获得了充足的休息

#### 计算公式
```swift
休息充足度评分 = min(实际休息时间比例, 1.0) × 100

其中:
实际休息时间比例 = 总休息时间 / 期望休息时间
期望休息时间 = 完成番茄钟数量 × 5分钟
```

#### 评分标准
- **100分**: 休息时间完全满足期望（每个番茄钟休息5分钟）
- **80分**: 休息时间达到期望的80%
- **60分**: 休息时间达到期望的60%
- **0分**: 没有完成任何番茄钟或没有休息

#### 数据来源
- `completedPomodoros`: 完成的番茄钟数量
- `totalBreakTime`: 总休息时间（秒）

---

### 2. 🟢 工作强度 (Work Intensity) - 第二环
**颜色**: 绿色渐变  
**位置**: 第二层圆环 (直径: 60%)  
**目标**: 评估用户的工作效率和工作-休息平衡

#### 计算公式
```swift
工作强度评分 = 番茄钟评分 + 休息平衡评分 + 一致性评分

番茄钟评分 = min(完成番茄钟数 / 8, 1.0) × 50
休息平衡评分 = min(工作休息比例 / 0.25, 1.0) × 30
一致性评分 = 取消休息次数 == 0 ? 20 : max(0, 20 - 取消休息次数 × 5)

其中:
工作休息比例 = 总休息时间 / 总工作时间
理想工作休息比例 = 0.25 (即工作4分钟休息1分钟)
```

#### 评分构成
- **番茄钟评分 (50分)**: 基于完成的番茄钟数量，理想目标8个
- **休息平衡评分 (30分)**: 基于工作与休息时间的比例
- **一致性评分 (20分)**: 基于是否坚持休息计划

#### 数据来源
- `completedPomodoros`: 完成的番茄钟数量
- `totalWorkTime`: 总工作时间（秒）
- `totalBreakTime`: 总休息时间（秒）
- `cancelledBreakCount`: 取消休息次数

---

### 3. 🔵 专注度 (Focus) - 第三环
**颜色**: 蓝色渐变  
**位置**: 第三层圆环 (直径: 39%)  
**目标**: 评估用户的专注程度和工作连续性

#### 计算公式
```swift
专注度评分 = max(0, min(100, 基础得分 - 中断惩罚))

基础得分 = 完成番茄钟数 × 10
中断惩罚 = (取消休息次数 + 息屏次数) × 5
```

#### 评分逻辑
- **基础得分**: 每完成一个番茄钟获得10分
- **中断惩罚**: 每次取消休息或息屏扣除5分
- **最终得分**: 在0-100分范围内

#### 数据来源
- `completedPomodoros`: 完成的番茄钟数量
- `cancelledBreakCount`: 取消休息次数
- `screenLockCount`: 息屏次数

---

### 4. 🟣 健康度 (Health) - 内环
**颜色**: 紫色渐变  
**位置**: 最内层圆环 (直径: 20%)  
**目标**: 综合评估用户的整体健康状况

#### 计算公式
```swift
健康度评分 = max(0, 基础分数 - 熬夜扣分 - 休息扣分 - 过劳扣分)

基础分数 = 100
熬夜扣分 = 熬夜次数 × 20
休息扣分 = 取消休息次数 × 5
过劳扣分 = 总工作时间 > 8小时 ? 20 : 0
```

#### 扣分机制
- **熬夜惩罚**: 每次熬夜扣除20分
- **休息惩罚**: 每次取消休息扣除5分
- **过劳惩罚**: 工作超过8小时扣除20分
- **最低保底**: 无活动时默认20分

#### 数据来源
- `stayUpLateCount`: 熬夜次数
- `cancelledBreakCount`: 取消休息次数
- `totalWorkTime`: 总工作时间（秒）

---

## 🎨 视觉呈现

### 圆环配置
```swift
enum RingType {
    case restAdequacy    // 外环 - 直径82%
    case workIntensity   // 第二环 - 直径60%
    case focus           // 第三环 - 直径39%
    case health          // 内环 - 直径20%
}
```

### 颜色方案
- **休息充足度**: 红色渐变 (`#FF6B6B` → `#FF8E8E`)
- **工作强度**: 绿色渐变 (`#4ECDC4` → `#6EE7B7`)
- **专注度**: 蓝色渐变 (`#45B7D1` → `#96CEB4`)
- **健康度**: 紫色渐变 (`#9966CC` → `#CC99FF`)

### 动画效果
- **呼吸动画**: 26秒循环，模拟自然呼吸节奏
- **进度动画**: 0.8秒平滑过渡到目标值
- **交互反馈**: 鼠标悬停时显示详细数据

---

## 📈 数据更新机制

### 实时更新
```swift
private func updateHealthRingsData() {
    let reportData = StatisticsManager.shared.generateTodayReport()
    let daily = reportData.dailyStats
    
    // 计算各项指标（0-100分）
    let restAdequacyScore = daily.restAdequacyScore
    let workIntensityScore = daily.workIntensityScore
    let focusScore = daily.focusScore
    let healthScore = daily.healthScore
    
    // 转换为0-1范围供视图使用
    let restAdequacy = restAdequacyScore / 100.0
    let workIntensity = workIntensityScore / 100.0
    let focus = focusScore / 100.0
    let health = healthScore / 100.0
}
```

### 默认值处理
- 无数据时显示示例数据以保持视觉效果
- 健康度最低保底20分
- 其他维度无数据时为0分

---

## 🎯 设计理念

### 用户体验
1. **直观性**: 圆环进度直观反映健康状况
2. **激励性**: 完整的圆环给用户成就感
3. **平衡性**: 四个维度相互制衡，避免单一指标偏向

### 算法特点
1. **科学性**: 基于番茄工作法的科学原理
2. **公平性**: 考虑不同工作模式的用户需求
3. **适应性**: 可根据用户反馈调整权重和阈值

### 扩展性
- 支持自定义评分权重
- 支持添加新的健康维度
- 支持个性化目标设置

---

## 📊 使用示例

### 理想状态
```
🔴 休息充足度: 100% (完成8个番茄钟，休息40分钟)
🟢 工作强度: 95% (8个番茄钟 + 良好休息比例 + 无取消)
🔵 专注度: 80% (8个番茄钟，无中断)
🟣 健康度: 100% (无熬夜，无过劳，无取消休息)
```

### 需要改进
```
🔴 休息充足度: 60% (休息时间不足)
🟢 工作强度: 70% (番茄钟数量偏少)
🔵 专注度: 45% (频繁中断)
🟣 健康度: 40% (熬夜 + 取消休息)
```

---

*本文档基于PomodoroScreen v1.0.1的实现，随着版本更新可能会有调整。*
