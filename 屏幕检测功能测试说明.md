# å±å¹•æ£€æµ‹åŠŸèƒ½è‡ªåŠ¨åŒ–æµ‹è¯•è¯´æ˜

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æµ‹è¯•å¥—ä»¶ä¸“é—¨ç”¨äºéªŒè¯PomodoroScreenåº”ç”¨çš„å±å¹•æ£€æµ‹å’Œä¼šè®®æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢åŠŸèƒ½ã€‚é€šè¿‡Mockæ¡†æ¶æ¨¡æ‹Ÿå„ç§æŠ•å±å’Œå¤–æ¥æ˜¾ç¤ºå™¨åœºæ™¯ï¼Œç¡®ä¿åŠŸèƒ½çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚

## ğŸ—ï¸ æµ‹è¯•æ¶æ„

### Mockæ¡†æ¶
```
MockScreenDetectionManager
â”œâ”€â”€ æ¨¡æ‹Ÿå±å¹•é…ç½®å˜åŒ–
â”œâ”€â”€ æ¨¡æ‹ŸæŠ•å±è¿æ¥/æ–­å¼€
â”œâ”€â”€ æ¨¡æ‹Ÿå¤–æ¥æ˜¾ç¤ºå™¨è¿æ¥/æ–­å¼€
â””â”€â”€ æ¨¡æ‹Ÿå„ç§åˆ†è¾¨ç‡åœºæ™¯
```

### æµ‹è¯•åˆ†å±‚
```
AutomatedTestRunner (æµ‹è¯•å¥—ä»¶è¿è¡Œå™¨)
â”œâ”€â”€ ScreenDetectionIntegrationTests (å±å¹•æ£€æµ‹é›†æˆæµ‹è¯•)
â”œâ”€â”€ MeetingModeAutoSwitchTests (ä¼šè®®æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢æµ‹è¯•)
â””â”€â”€ æ€§èƒ½å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### 1. å±å¹•æ£€æµ‹åŸºç¡€åŠŸèƒ½æµ‹è¯• (`ScreenDetectionIntegrationTests`)

#### åŸºç¡€æ£€æµ‹æµ‹è¯•
- **testScreenDetection_SingleScreen**: éªŒè¯å•å±çŠ¶æ€æ£€æµ‹
- **testScreenDetection_ExternalMonitor**: éªŒè¯å¤–éƒ¨æ˜¾ç¤ºå™¨æ£€æµ‹
- **testScreenDetection_Screencasting**: éªŒè¯æŠ•å±çŠ¶æ€æ£€æµ‹

#### è‡ªåŠ¨ä¼šè®®æ¨¡å¼æµ‹è¯•
- **testAutoMeetingMode_EnabledOnScreencast**: éªŒè¯æŠ•å±æ—¶è‡ªåŠ¨å¯ç”¨ä¼šè®®æ¨¡å¼
- **testAutoMeetingMode_DisabledWhenAutoDetectionOff**: éªŒè¯ç¦ç”¨è‡ªåŠ¨æ£€æµ‹æ—¶çš„è¡Œä¸º

#### ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
- **testFullIntegration_ConnectAndDisconnectScreencast**: å®Œæ•´çš„è¿æ¥/æ–­å¼€æµç¨‹æµ‹è¯•
- **testFullIntegration_MultipleScreenChanges**: å¤šæ¬¡å±å¹•å˜åŒ–æµ‹è¯•

#### è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- **testEdgeCase_CommonProjectionResolutions**: å¸¸è§æŠ•å±åˆ†è¾¨ç‡æµ‹è¯•
- **testEdgeCase_RapidScreenChanges**: å¿«é€Ÿå±å¹•å˜åŒ–æµ‹è¯•

### 2. ä¼šè®®æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢æµ‹è¯• (`MeetingModeAutoSwitchTests`)

#### è‡ªåŠ¨å¯ç”¨æµ‹è¯•
- **testAutoEnable_OnExternalMonitorConnect**: å¤–éƒ¨æ˜¾ç¤ºå™¨è¿æ¥æ—¶è‡ªåŠ¨å¯ç”¨
- **testAutoEnable_OnScreencastConnect**: æŠ•å±è¿æ¥æ—¶è‡ªåŠ¨å¯ç”¨
- **testAutoEnable_SkipWhenAlreadyEnabled**: å·²å¯ç”¨æ—¶è·³è¿‡é‡å¤å¯ç”¨
- **testAutoEnable_SkipWhenAutoDetectionDisabled**: ç¦ç”¨è‡ªåŠ¨æ£€æµ‹æ—¶è·³è¿‡

#### è‡ªåŠ¨å…³é—­æµ‹è¯•
- **testAutoDisable_OnExternalScreenDisconnect**: å¤–éƒ¨å±å¹•æ–­å¼€æ—¶è‡ªåŠ¨å…³é—­
- **testAutoDisable_SkipWhenManuallyEnabled**: æ‰‹åŠ¨å¯ç”¨æ—¶è·³è¿‡è‡ªåŠ¨å…³é—­

#### å¤æ‚åœºæ™¯æµ‹è¯•
- **testComplexScenario_MultipleConnectDisconnect**: å¤šæ¬¡è¿æ¥æ–­å¼€åœºæ™¯
- **testComplexScenario_ManualOverrideAutomatic**: æ‰‹åŠ¨è¦†ç›–è‡ªåŠ¨è®¾ç½®åœºæ™¯

### 3. è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œå™¨ (`AutomatedTestRunner`)

#### å®Œæ•´æµ‹è¯•å¥—ä»¶
- **testScreenDetectionFullSuite**: æ‰§è¡Œæ‰€æœ‰æµ‹è¯•åœºæ™¯å¹¶ç”ŸæˆæŠ¥å‘Š

#### æµ‹è¯•åœºæ™¯è¦†ç›–
- åŸºç¡€å±å¹•æ£€æµ‹åŠŸèƒ½
- ä¼šè®®æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢
- è¾¹ç•Œæ¡ä»¶å¤„ç†
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

## ğŸš€ è¿è¡Œæµ‹è¯•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./run_screen_detection_tests.sh
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨Xcodeå‘½ä»¤è¡Œ
```bash
# è¿è¡Œå±å¹•æ£€æµ‹é›†æˆæµ‹è¯•
xcodebuild test -scheme PomodoroScreen \
  -destination 'platform=iOS Simulator,name=iPhone 16' \
  -only-testing "PomodoroScreenTests/ScreenDetectionIntegrationTests"

# è¿è¡Œä¼šè®®æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢æµ‹è¯•
xcodebuild test -scheme PomodoroScreen \
  -destination 'platform=iOS Simulator,name=iPhone 16' \
  -only-testing "PomodoroScreenTests/MeetingModeAutoSwitchTests"

# è¿è¡Œå®Œæ•´è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶
xcodebuild test -scheme PomodoroScreen \
  -destination 'platform=iOS Simulator,name=iPhone 16' \
  -only-testing "PomodoroScreenTests/AutomatedTestRunner"
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨Xcode IDE
1. æ‰“å¼€PomodoroScreen.xcodeproj
2. é€‰æ‹©æµ‹è¯•å¯¼èˆªå™¨ (âŒ˜6)
3. å±•å¼€PomodoroScreenTests
4. å³é”®ç‚¹å‡»æµ‹è¯•ç±»æˆ–æ–¹æ³•ï¼Œé€‰æ‹©"Run"

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š
æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼š
- **æµ‹è¯•æŠ¥å‘Š**: `TestResults/test_report_YYYYMMDD_HHMMSS.md`
- **æ„å»ºæ—¥å¿—**: `TestResults/build.log`
- **æµ‹è¯•æ—¥å¿—**: `TestResults/*_tests.log`

### æŠ¥å‘Šå†…å®¹
- æµ‹è¯•ç»“æœæ¦‚è§ˆ
- åŠŸèƒ½è¦†ç›–æƒ…å†µ
- è¯¦ç»†æµ‹è¯•ç»“æœ
- æ€§èƒ½åŸºå‡†æ•°æ®
- é”™è¯¯æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯

## ğŸ¯ Mockåœºæ™¯

### å±å¹•é…ç½®æ¨¡æ‹Ÿ
```swift
// å•å±çŠ¶æ€
mockScreenDetection.simulateResetToSingleScreen()

// å¤–éƒ¨æ˜¾ç¤ºå™¨è¿æ¥
mockScreenDetection.simulateExternalScreenConnected(width: 2560, height: 1440)

// æŠ•å±åœºæ™¯
mockScreenDetection.simulateScreencasting(mirrorResolution: true)

// æ–­å¼€å¤–éƒ¨å±å¹•
mockScreenDetection.simulateExternalScreenDisconnected()
```

### æ”¯æŒçš„æŠ•å±åˆ†è¾¨ç‡
- 1920Ã—1080 (Full HD)
- 1280Ã—720 (HD)
- 1024Ã—768 (XGA)
- 1280Ã—800 (WXGA)
- 1366Ã—768 (å¸¸è§ç¬”è®°æœ¬)
- 1600Ã—900 (HD+)
- 1440Ã—900 (WXGA+)
- 1680Ã—1050 (WSXGA+)

## ğŸ”§ æµ‹è¯•é…ç½®

### UserDefaultsé”®å€¼
```swift
// ä¼šè®®æ¨¡å¼è®¾ç½®
"MeetingModeEnabled": Bool          // ä¼šè®®æ¨¡å¼æ˜¯å¦å¯ç”¨
"MeetingModeAutoEnabled": Bool      // æ˜¯å¦ä¸ºè‡ªåŠ¨å¯ç”¨
"AutoDetectScreencastEnabled": Bool // è‡ªåŠ¨æ£€æµ‹æŠ•å±æ˜¯å¦å¯ç”¨
```

### Mockå›è°ƒæœºåˆ¶
```swift
mockScreenDetection.onScreenConfigurationChanged = { hasExternalScreen in
    // å¤„ç†å±å¹•é…ç½®å˜åŒ–
}
```

## âš¡ æ€§èƒ½åŸºå‡†

### æ£€æµ‹æ“ä½œæ€§èƒ½
- **ç›®æ ‡**: 1000æ¬¡æ£€æµ‹æ“ä½œåœ¨1ç§’å†…å®Œæˆ
- **æµ‹è¯•æ–¹æ³•**: `testPerformance_ScreenDetection`
- **éªŒè¯æŒ‡æ ‡**: å“åº”æ—¶é—´ã€å†…å­˜ä½¿ç”¨ã€CPUå ç”¨

### å¿«é€Ÿåˆ‡æ¢å¤„ç†
- **åœºæ™¯**: 5æ¬¡å¿«é€Ÿè¿æ¥/æ–­å¼€å¾ªç¯
- **éªŒè¯**: æ‰€æœ‰äº‹ä»¶æ­£ç¡®å¤„ç†ï¼ŒçŠ¶æ€ä¸€è‡´

## ğŸ› è°ƒè¯•æ”¯æŒ

### æ—¥å¿—è¾“å‡º
æ‰€æœ‰Mockæ“ä½œéƒ½ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼š
```
ğŸ“º [Mock] æ¨¡æ‹Ÿå¤–éƒ¨å±å¹•è¿æ¥: 1920x1080
ğŸ“º [Mock] å±å¹•æ£€æµ‹: æ€»å±å¹•æ•° 2, å¤–éƒ¨å±å¹•: true
ğŸ“º [Mock] æ£€æµ‹åˆ°æŠ•å±/å¤–æ¥æ˜¾ç¤ºå™¨ï¼Œè‡ªåŠ¨å¯ç”¨ä¼šè®®æ¨¡å¼
```

### æµ‹è¯•çŠ¶æ€è·Ÿè¸ª
- å±å¹•é…ç½®å˜åŒ–è®¡æ•°
- ä¼šè®®æ¨¡å¼åˆ‡æ¢æ¬¡æ•°
- UserDefaultsçŠ¶æ€éªŒè¯
- å›è°ƒæ‰§è¡ŒéªŒè¯

## ğŸ“ æ‰©å±•æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹
1. ç»§æ‰¿ç°æœ‰æµ‹è¯•ç±»æˆ–åˆ›å»ºæ–°çš„æµ‹è¯•ç±»
2. ä½¿ç”¨`MockScreenDetectionManager`æ¨¡æ‹Ÿåœºæ™¯
3. éªŒè¯é¢„æœŸè¡Œä¸ºå’ŒçŠ¶æ€å˜åŒ–
4. æ·»åŠ åˆ°`AutomatedTestRunner`ä¸­

### è‡ªå®šä¹‰Mockåœºæ™¯
```swift
// åˆ›å»ºè‡ªå®šä¹‰åˆ†è¾¨ç‡åœºæ™¯
mockScreenDetection.simulateExternalScreenConnected(width: 3440, height: 1440)

// æ¨¡æ‹Ÿç‰¹æ®ŠæŠ•å±åœºæ™¯
mockScreenDetection.simulateScreencasting(mirrorResolution: false)
```

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æ­£ç¡®æ€§
- [ ] æ‰€æœ‰å±å¹•æ£€æµ‹æµ‹è¯•é€šè¿‡
- [ ] ä¼šè®®æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢æ­£å¸¸
- [ ] è¾¹ç•Œæ¡ä»¶å¤„ç†æ­£ç¡®
- [ ] çŠ¶æ€ä¸€è‡´æ€§éªŒè¯é€šè¿‡

### æ€§èƒ½è¦æ±‚
- [ ] æ£€æµ‹æ“ä½œå“åº”æ—¶é—´ < 1ms
- [ ] 1000æ¬¡æ“ä½œæ€»æ—¶é—´ < 1s
- [ ] å¿«é€Ÿåˆ‡æ¢åœºæ™¯ç¨³å®š

### ç¨³å®šæ€§è¦æ±‚
- [ ] è¿ç»­æµ‹è¯•æ— å´©æºƒ
- [ ] å†…å­˜ä½¿ç”¨ç¨³å®š
- [ ] çŠ¶æ€ç®¡ç†ä¸€è‡´

---

*è¯¥æµ‹è¯•å¥—ä»¶ç¡®ä¿å±å¹•æ£€æµ‹å’Œä¼šè®®æ¨¡å¼åŠŸèƒ½åœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½å¯é å·¥ä½œï¼Œä¸ºç”¨æˆ·æä¾›ç¨³å®šçš„ä½¿ç”¨ä½“éªŒã€‚*
